{% extends "base.html" %}
{% block title %}{{ recipe.recipe_name or recipe.name or 'Recipe Details' }}{% endblock %}
{% block content %}
<div class="container d-flex justify-content-center align-items-center" style="min-height: 60vh;">
  <div class="card shadow-lg p-4" style="max-width: 600px; width: 100%; border-radius: 18px; background: #fffefb;">
    {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
    {% elif recipe %}
      <div class="d-flex flex-column align-items-center mb-3">
            <h1 class="display-5 fw-bold text-primary mb-2" style="text-align:center;">{{ recipe.name }}</h1>
            {% if recipe.image_url %}
              <img src="{{ recipe.image_url }}" alt="{{ recipe.name }}" class="img-fluid rounded shadow-sm mb-3" style="max-width:320px;"/>
            {% endif %}
          </div>
          <h3 class="mt-3 mb-2 text-success d-flex align-items-center">Ingredients
            {% if recipe.serving_size %}
              <span class="badge bg-secondary ms-3" style="font-size:0.7em;">Serves {{ recipe.serving_size }}</span>
            {% endif %}
          </h3>
          <ul class="list-unstyled mb-4">
            {% for ing in recipe.ingredients %}
              <li class="mb-1">
                <span class="badge bg-light text-dark border me-2" style="font-size:1em; min-width:60px;">{{ ing.quantity or '' }} {{ ing.unit or '' }}</span>
                <span class="fw-semibold">{{ ing.name or ing.ingredient or ing }}</span>
              </li>
            {% endfor %}
          </ul>
          <h3 class="mt-4 mb-2 text-info">Instructions</h3>
          <div class="recipe-instructions bg-light p-3 rounded shadow-sm mb-3" style="font-size:1.08em; line-height:1.7;">

            {% if recipe.instructions %}
              <ol class="ps-3">
                {% for step in recipe.instructions.split('\n') if step.strip() %}
                  <li>{{ step }}</li>
                {% endfor %}
              </ol>
            {% else %}
              <em>No instructions provided.</em>
            {% endif %}
            {% if recipe.source_url %}
              <div class="mt-3"><strong>Source:</strong> <a href="{{ recipe.source_url }}" target="_blank">{{ recipe.source_url }}</a></div>
            {% endif %}
          </div>
          {% if current_user.is_authenticated and ('Admin' in current_user.get_all_roles() or 'Recipe Editor' in current_user.get_all_roles()) %}
            <form method="post" action="/edit_instructions/{{ recipe.id }}" class="mb-3">
              <button type="submit" class="btn btn-warning">Edit Instructions</button>
            </form>
          {% endif %}
          {% if recipe.serving_size %}
            <div class="mb-2"><span class="badge bg-secondary">Servings: {{ recipe.serving_size }}</span></div>
          {% endif %}
        {% else %}
        <div class="alert alert-warning">Recipe not found.</div>
      {% endif %}
    </div>

        <div class="d-flex justify-content-center mt-4">
          <a href="/recbk" class="btn btn-lg btn-outline-primary">&larr; Back to Recipe Book</a>
        </div>
      </div>
{% endblock %}

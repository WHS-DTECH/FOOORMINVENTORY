<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recipes</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <nav class="navbar">
    <div class="nav-left">
      <a href="/" class="nav-brand">üç≥ Food Room</a> |
      <a href="/recbk">Recipe Book</a> |
      <a href="/recipes">Recipes</a>
      {% if current_user.is_authenticated %}
        | <a href="/class_ingredients">Class Ingredients</a>
        | <a href="/booking">Booking Calendar</a>
        | <a href="/shoplist">Shopping List</a>
        {% if current_user.is_admin() %}
          | <a href="/admin">Admin</a>
        {% endif %}
      {% endif %}
    </div>
    <div class="nav-right">
      {% if current_user.is_authenticated %}
        <span class="user-info">{{ current_user.name }}<span class="badge badge-{{ current_user.role }}">{{ current_user.role }}</span></span> | <a href="/logout" class="logout-link">Logout</a>
      {% else %}
        <a href="/login" class="login-link">Login</a>
      {% endif %}
    </div>
  </nav>
  
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div style="margin:10px 0;padding:12px;background:#d4edda;border:1px solid #c3e6cb;color:#155724;border-radius:4px;max-width:720px;">
        {% for message in messages %}
          <div>{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}
  
  <h1>Recipes</h1>
  
  <!-- Modern Search Bar and Filters -->
  <div class="container-fluid mb-4">
    <form id="searchForm" method="get" action="/recipes" class="row g-3 align-items-center justify-content-center" style="max-width:900px; margin:auto;">
      <div class="col-12 col-md-6">
        <input type="search" name="q" class="form-control form-control-lg" placeholder="Search recipes by name, ingredient, or instructions..." value="{{ q }}" aria-label="Search recipes">
      </div>
      <div class="col-12 col-md-auto d-flex flex-wrap gap-2">
        <select name="dietary" class="form-select rounded-pill px-3" style="min-width:120px;">
          <option value="">All Dietary</option>
          {% for tag in all_dietary_tags %}
            <option value="{{ tag }}" {% if dietary == tag %}selected{% endif %}>{{ tag }}</option>
          {% endfor %}
        </select>
        <select name="cuisine" class="form-select rounded-pill px-3" style="min-width:120px;">
          <option value="">All Cuisines</option>
          {% for c in all_cuisines %}
            <option value="{{ c }}" {% if cuisine == c %}selected{% endif %}>{{ c }}</option>
          {% endfor %}
        </select>
        <select name="difficulty" class="form-select rounded-pill px-3" style="min-width:120px;">
          <option value="">All Difficulty</option>
          <option value="Easy" {% if difficulty == 'Easy' %}selected{% endif %}>Easy</option>
          <option value="Medium" {% if difficulty == 'Medium' %}selected{% endif %}>Medium</option>
          <option value="Hard" {% if difficulty == 'Hard' %}selected{% endif %}>Hard</option>
        </select>
      </div>
      <div class="col-12 col-md-auto d-flex gap-2 align-items-center">
        <button type="submit" class="btn btn-success px-4 py-2">Search</button>
        {% if q or dietary or cuisine or difficulty %}
          <a href="/recipes" class="btn btn-secondary px-4 py-2">Clear</a>
        {% endif %}
        <span class="text-muted ms-2" style="font-size:1.1em;">{{ rows|length }} recipe(s) found</span>
      </div>
    </form>

    <!-- Quick Filter Chips -->
    <div class="d-flex flex-wrap gap-2 justify-content-center mt-2 mb-1">
      {% set quick_tags = ['Vegetarian', 'Vegan', 'Gluten Free', 'Dairy Free', 'Nut Free'] %}
      {% for tag in quick_tags %}
        <button type="button" class="btn btn-sm rounded-pill px-3 py-1 quick-chip {% if dietary == tag %}btn-success text-white{% else %}btn-outline-success{% endif %}"
          onclick="applyQuickFilter('{{ tag }}')">{{ tag }}</button>
      {% endfor %}
    </div>
    <script>
      function applyQuickFilter(tag) {
        const form = document.getElementById('searchForm');
        form.dietary.value = tag;
        form.submit();
      }
    </script>
  </div>
  <!-- Suggestion box remains below or to the side as needed -->
  <div class="container-fluid mb-4">
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 col-lg-6">
        <div style="padding:20px; border:2px solid #007bff; background:#f0f8ff; border-radius:8px;">
          <h3 style="margin-top:0; color:#007bff;">üí° Suggest a Recipe</h3>
          <p style="color:#666; margin-bottom:15px;">Have a recipe you'd like added to our collection? Share your suggestion with the VP!</p>
          <form id="suggestionForm" method="post" action="/recipes/suggest">
            <div style="margin-bottom:12px;">
              <label style="display:block; margin-bottom:4px; font-weight:bold;">Recipe Name:</label>
              <input type="text" name="recipe_name" required style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px;" placeholder="e.g., Chocolate Chip Cookies">
            </div>
            <div style="margin-bottom:12px;">
              <label style="display:block; margin-bottom:4px; font-weight:bold;">Recipe URL (optional):</label>
              <input type="url" name="recipe_url" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px;" placeholder="https://...">
            </div>
            <div style="margin-bottom:12px;">
              <label style="display:block; margin-bottom:4px; font-weight:bold;">Why should we add this recipe?</label>
              <textarea name="reason" rows="3" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px;" placeholder="Tell us why this recipe would be great for our students..."></textarea>
            </div>
            <button type="submit" style="padding:10px 24px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer; font-size:14px; font-weight:bold;">üìß Send Suggestion</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  {% if rows %}
  <div class="container-fluid">
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4" style="margin-top: 18px;">
      {% for r in rows %}
      <div class="col">
        <div class="card h-100 recipe-card border-0" tabindex="0">
          {% if r.image_url %}
            <img src="{{ r.image_url }}" class="card-img-top recipe-img" alt="{{ r.name }}">
          {% else %}
            <div class="d-flex align-items-center justify-content-center bg-light recipe-img" style="font-size:3em; color:#bbb;">
              <i class="bi bi-egg-fried"></i>
            </div>
          {% endif %}
          <div class="card-body d-flex flex-column">
            <h5 class="card-title fw-bold text-primary">{{ r.name }}</h5>
            <div class="mb-2">
              {% if r.serving_size %}
                <span class="badge bg-secondary me-1">Serves {{ r.serving_size }}</span>
              {% endif %}
              {% if r.dietary %}
                <span class="badge bg-success me-1">{{ r.dietary }}</span>
              {% endif %}
              {% if r.cuisine %}
                <span class="badge bg-info text-dark me-1">{{ r.cuisine }}</span>
              {% endif %}
            </div>
            <div class="mb-2 text-muted" style="font-size:0.98em; min-height: 2.5em;">
              {% if r.instructions %}
                {{ r.instructions.split('\n')[0][:120] }}{% if r.instructions|length > 120 %}...{% endif %}
              {% else %}
                <em>No description available.</em>
              {% endif %}
            </div>
            <div class="mt-auto">
              <a href="/recipe/{{ r.id }}" class="btn btn-outline-primary w-100">View Recipe</a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  {% else %}
    <div class="d-flex flex-column align-items-center justify-content-center" style="min-height:280px;">
      <div class="card p-4 text-center" style="max-width:400px; border-radius:18px; background:#f8fafc; border:1px solid #e0e4ea;">
        <div style="font-size:3em; color:#b0b8c9;">
          <i class="bi bi-emoji-frown"></i>
        </div>
        <h4 class="mt-2 mb-1 text-secondary">No recipes found</h4>
        <div class="mb-2 text-muted">Try adjusting your search or filter criteria.<br>Or suggest a new recipe below!</div>
      </div>
    </div>
  {% endif %}

  <style>
    .recipe-card {
      border-radius: 16px;
      background: #fffefb;
      transition: box-shadow 0.18s, transform 0.18s;
      box-shadow: 0 2px 8px rgba(66,133,244,0.07);
      outline: none;
    }
    .recipe-card:hover, .recipe-card:focus {
      box-shadow: 0 6px 24px rgba(66,133,244,0.18);
      transform: translateY(-2px) scale(1.025);
      z-index: 2;
    }
    .recipe-img {
      object-fit: cover;
      height: 180px;
      width: 100%;
      border-radius: 16px 16px 0 0;
      background: #f8f9fa;
    }
  </style>

</body>
</html>
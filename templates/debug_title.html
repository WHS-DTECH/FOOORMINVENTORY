{% extends "base.html" %}
{% block content %}
<div style="width:100%; display:flex; justify-content:flex-end; margin-bottom:1em;">
  <form method="get" action="/parser_debug_raw/{{ test_recipe_id }}" style="margin:0;">
    <button type="submit" class="btn btn-outline-secondary" style="font-size:1em;">View Raw Data</button>
  </form>
</div>
<div style="display: flex; gap: 2em;">
  <div style="flex: 1;">
    <h3>Raw Data (HTML/Text)</h3>
    <div style="display: flex;">
      <div style="background: #f0f0f0; color: #888; padding: 1em 0.5em 1em 1em; border: 1px solid #ccc; border-right: none; text-align: right; user-select: none; font-family: monospace;">
        {% set lines = (raw_data or raw_title or '') .split('\n') %}
        {% for i in range(1, lines|length + 1) %}
          <div style="min-width: 2.5em;">{{ i }}</div>
        {% endfor %}
      </div>
        <div style="display: flex; flex-direction: row; align-items: flex-start; gap: 32px;">
          <textarea readonly rows="30" style="width: 60vw; max-width: 700px; min-width: 350px; font-family: monospace; font-size: 14px; background: #fafbfc; border: 1px solid #ddd; padding: 10px; margin-bottom: 20px; resize: horizontal;">{{ raw_data }}</textarea>
          <div style="flex: 1; min-width: 220px;">
            <div style="position: sticky; top: 0;">
              <div style="margin-bottom: 12px;">
                <strong>Title Extraction Strategies</strong>
              </div>
              <div id="title-strategies-box">
                <!-- Existing strategies/results content will be rendered here -->
                <div style="margin-bottom: 8px;">
                  <span style="font-weight: bold;">Strategy</span> <span style="font-weight: bold;">Result</span>
                </div>
                <!-- Jinja2 block for strategies/results if present -->
                {% if strategies %}
                  {% for strat, result in strategies.items() %}
                    <div><span>{{ strat }}</span>: <span>{{ result }}</span></div>
                  {% endfor %}
                {% endif %}
                <div style="margin-top: 16px;"><strong>Best Guess:</strong> {{ best_guess }}</div>
              </div>
            </div>
          </div>
        </div>
    </div>
  </div>
  <div style="flex: 1;">
    <h3>Title Extraction Strategies</h3>
    <table class="table table-bordered">
      <thead><tr><th>Strategy</th><th>Result</th></tr></thead>
      <tbody>
        {% for strat in strategies %}
        <tr{% if strat.best %} style="background: #d0f5d0;"{% endif %}>
          <td>{{ strat.name }}</td>
          <td>{{ strat.value }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <h4>Best Guess:</h4>
    <div style="font-size: 1.2em; font-weight: bold; color: #0074d9;">{{ best_guess }}</div>
  </div>
</div>
{% endblock %}

{% extends "base.html" %}
{% block content %}
<style>
.parser-debug-container {
  display: flex;
  gap: 32px;
  align-items: flex-start;
  margin-top: 2em;
}
.parser-debug-col {
  flex: 1 1 0;
  min-width: 220px;
}
.debug-btn {
  background: #d32f2f;
  color: #fff;
  font-weight: bold;
  text-transform: uppercase;
  border: none;
  padding: 6px 16px;
  border-radius: 4px;
  margin-right: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}
.confirm-btn {
  background: #388e3c;
  color: #fff;
  font-weight: bold;
  border: none;
  padding: 6px 16px;
  border-radius: 4px;
}
.grey-btn {
    background: #757575;
    color: #fff;
    font-weight: bold;
    border: none;
    padding: 6px 16px;
    border-radius: 4px;
    margin-right: 8px;
}
@media (max-width: 900px) {
  .parser-debug-container {
    flex-direction: column;
    gap: 16px;
  }
}
</style>
<div style="width:100%; text-align:center; margin-top:2em;">
    <h1 style="font-size:2.2rem; font-weight:bold; margin-bottom:0.5em;">Parser Debug: Flagged/Test Recipe</h1>
</div>
<div style="width:100%; display:flex; justify-content:center; margin-bottom:2em;">
    <div style="max-width:700px; background:#fafafa; border-radius:6px; box-shadow:0 1px 4px #eee; padding:1em 2em; font-size:1rem; text-align:left;">
        <div><a href="{{ test_recipe.upload_source_detail }}" target="_blank">{{ test_recipe.upload_source_detail }}</a></div>
        <div>Flagged by: {{ test_recipe.uploaded_by }}</div>
        <div>Flagged at: {{ test_recipe.upload_date }}</div>
        <div><strong>Notes:</strong> {{ test_recipe.notes }}</div>
        <div><strong>Source Type:</strong> {{ test_recipe.upload_source_type }}</div>
        <div><strong>Recipe ID:</strong> {{ test_recipe.recipe_id or 'N/A' }}</div>
        <form method="get" action="/parser_debug_raw/{{ test_recipe.id }}" style="margin-top:0.5em;">
            <button type="submit" class="btn btn-outline-dark btn-sm">View Raw Data</button>
        </form>
    </div>
</div>
<div class="parser-debug-container">
    <div class="parser-debug-col">
        <div class="card mb-3">
            <div class="card-header bg-dark text-white">Event Details (Full Record)</div>
            <div class="card-body" style="font-size:0.97em;">
                <pre style="white-space:pre-wrap; word-break:break-all; background:#f8f8f8; border:1px solid #eee; border-radius:4px; padding:8px; max-height:320px; overflow:auto;">{{ test_recipe | pprint }}</pre>
                <div style="font-size:0.93em; color:#888; margin-top:4px;">This shows all fields for this flagged/test recipe event, for context and troubleshooting.</div>
            </div>
        </div>
    </div>
    <div class="parser-debug-col">
        <div class="card mb-3">
            <div class="card-header bg-primary text-white">Title</div>
            <div class="card-body">
                {% if confirmed.title %}
                    <span style="color: #388e3c; font-weight: bold;">{{ confirmed.title }}</span>
                    <span class="text-muted" style="font-size:0.95em;">(confirmed)</span>
                {% else %}
                    {{ test_recipe.upload_source_detail }}
                {% endif %}
            </div>
        </div>
        <div class="card mb-3">
            <div class="card-header bg-purple text-white">Serving Size</div>
            <div class="card-body">{{ test_recipe.serving_size or 'N/A' }}</div>
        </div>
        <div class="card mb-3">
            <div class="card-header bg-secondary text-white">Source URL</div>
            <div class="card-body"><a href="{{ test_recipe.upload_source_detail }}" target="_blank">{{ test_recipe.upload_source_detail }}</a></div>
        </div>
        <div class="card mb-3">
            <div class="card-header bg-success text-white">Ingredients</div>
            <div class="card-body">{{ test_recipe.ingredients or 'No ingredients found.' }}</div>
        </div>
        <div class="card mb-3">
            <div class="card-header bg-warning text-dark">Instructions</div>
            <div class="card-body">{{ test_recipe.instructions or 'No instructions found.' }}</div>
        </div>
    </div>
    <div class="parser-debug-col">
        <div class="card mb-3">
            <div class="card-header bg-primary text-white">Actions</div>
            <div class="card-body">
                <form method="get" action="/debug_title/{{ test_recipe.id }}" style="display:inline-block;">
                    <button type="submit" class="debug-btn" style="background:#1976d2; color:#fff;">DEBUG</button>
                </form>
                <hr>
                <form method="get" action="/debug_serving_size/{{ test_recipe.id }}" style="display:inline-block;">
                    <button type="submit" class="debug-btn">DEBUG</button>
                </form>
                <form method="post" action="/confirm_field" style="display:inline-block;">
                    <input type="hidden" name="field" value="serving_size">
                    <input type="hidden" name="test_recipe_id" value="{{ test_recipe.id }}">
                    <button type="submit" class="confirm-btn" style="background:#8e24aa; color:#fff;">CONFIRM</button>
                </form>
                <hr>
                <form method="get" action="/debug_source_url/{{ test_recipe.id }}" style="display:inline-block;">
                    <button type="submit" class="grey-btn">DEBUG</button>
                </form>
                <form method="post" action="/confirm_field" style="display:inline-block;">
                    <input type="hidden" name="field" value="source_url">
                    <input type="hidden" name="test_recipe_id" value="{{ test_recipe.id }}">
                    <button type="submit" class="grey-btn bg-secondary text-white">CONFIRM</button>
                </form>
                <hr>
                <form method="get" action="/debug_ingredients/{{ test_recipe.id }}" style="display:inline-block;">
                    <button type="submit" class="debug-btn">DEBUG</button>
                </form>
                <form method="post" action="/confirm_field" style="display:inline-block;">
                    <input type="hidden" name="field" value="ingredients">
                    <input type="hidden" name="test_recipe_id" value="{{ test_recipe.id }}">
                    <button type="submit" class="confirm-btn bg-success text-white">CONFIRM</button>
                </form>
                <hr>
                <form method="get" action="/debug_instructions/{{ test_recipe.id }}" style="display:inline-block;">
                    <button type="submit" class="debug-btn">DEBUG</button>
                </form>
                <form method="post" action="/confirm_field" style="display:inline-block;">
                    <input type="hidden" name="field" value="instructions">
                    <input type="hidden" name="test_recipe_id" value="{{ test_recipe.id }}">
                    <button type="submit" class="confirm-btn bg-warning text-dark">CONFIRM</button>
                </form>
            </div>
        </div>
    </div>
    <div class="parser-debug-col">
        <div class="card mb-3">
            <div class="card-header bg-primary text-white">Confirmed Values</div>
            <div class="card-body">
                <div><strong>Title:</strong> {{ confirmed.title or '' }}</div>
                <div><strong>Serving Size:</strong> {{ confirmed.serving_size or '' }}</div>
                <div><strong>Source URL:</strong> {{ confirmed.source_url or '' }}</div>
                <div><strong>Ingredients:</strong> {{ confirmed.ingredients or '' }}</div>
                <div><strong>Instructions:</strong> {{ confirmed.instructions or '' }}</div>
            </div>
        </div>
        <div style="text-align:center; margin-top:1em;">
            <button class="btn btn-primary" disabled>Upload Recipe</button>
        </div>
    </div>
</div>
{% endblock %}

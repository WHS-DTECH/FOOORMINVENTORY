<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weekly Shopping List</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <nav class="navbar no-print">
    <div class="nav-left">
      <a href="/" class="nav-brand">üç≥ Food Room</a> |
      <a href="/recipes">Recipes</a> |
      <a href="/recbk">Recipe Book</a> |
      <a href="/class_ingredients">Class Ingredients</a> |
      <a href="/booking">Booking Calendar</a> |
      <a href="/shoplist">Shopping List</a>
      {% if current_user.is_admin() %}
        | <a href="/admin">Admin</a>
      {% endif %}
    </div>
    <div class="nav-right">
      {% if current_user.is_authenticated %}
        <span class="user-info">{{ current_user.name }}<span class="badge badge-{{ current_user.role }}">{{ current_user.role }}</span></span> | <a href="/logout" class="logout-link">Logout</a>
      {% else %}
        <a href="/login" class="login-link">Login</a>
      {% endif %}
    </div>
  </nav>

  <div class="week-nav no-print">
    <span class="label">{{ week_label }}</span>
    <a href="/shoplist?week={{ prev_week }}">Previous Week</a>
    {% if week_offset != 0 %}
    <a href="/shoplist?week=0" style="font-weight: bold;">Current Week</a>
    {% endif %}
    <a href="/shoplist?week={{ next_week }}">Next Week</a>
  </div>

  <div id="shoplist-actions-fixed" class="actions no-print shoplist-actions-top" style="margin-bottom: 18px; justify-content: flex-end; display: flex; gap: 8px; flex-wrap: wrap;">
    <button onclick="saveShoppingList()">üíæ Save List</button>
    <button onclick="loadShoppingList()">üìÇ Load Saved</button>
    <button onclick="exportShoppingListCsv()">üìÑ Export CSV</button>
    <button class="primary" onclick="window.print()">üñ®Ô∏è Print</button>
    <span style="flex: 1 1 auto;"></span>
    <button class="primary no-print" id="printListOnlyBtn" style="background: #28a745; margin-left: auto;" onclick="printShoppingListOnly()">üñ®Ô∏è Print Shopping List Only</button>
  </div>
    <style>
      body, html {
        font-family: Arial, Helvetica, sans-serif;
      }
      @media print {
        @page {
          size: A4 portrait;
          margin: 18mm 12mm 18mm 12mm;
        }
        html, body {
          margin: 0 !important;
          padding: 0 !important;
          font-family: Arial, Helvetica, sans-serif !important;
        }
        body.print-list-only * {
          visibility: hidden !important;
        }
        body.print-list-only .print-list-section, 
        body.print-list-only .print-list-section * {
          visibility: visible !important;
          display: block !important;
          position: static !important;
          width: 100% !important;
          min-width: 0 !important;
          margin: 0 !important;
          padding: 0 !important;
          background: white !important;
          color: black !important;
        }
        /* Stack columns vertically for print to avoid page breaks in the middle of a flex row */
        body.print-list-only .print-list-section > div {
          display: block !important;
        }
        /* Hide checkboxes for print */
        body.print-list-only input[type="checkbox"] {
          display: none !important;
        }
        /* Print-only header */
        .print-header {
          display: block !important;
          text-align: center;
          margin-bottom: 18px;
        }
        /* Print date */
        .print-date {
          display: block !important;
          text-align: right;
          font-size: 12px;
          color: #444;
          margin-bottom: 8px;
        }
        /* Page numbers */
        body.print-list-only::after {
          content: "Page " counter(page);
          position: fixed;
          bottom: 8mm;
          right: 12mm;
          font-size: 12px;
          color: #444;
        }
        /* Table styling for print */
        .print-category-table {
          width: 100%;
          border-collapse: collapse;
          margin-bottom: 18px;
        }
        .print-category-table th, .print-category-table td {
          border: 1px solid #bbb;
          padding: 4px 8px;
          font-size: 15px;
        }
        .print-category-table th {
          background: #f0f0f0;
        }
        .print-section-sep {
          border-top: 2px solid #333;
          margin: 18px 0 12px 0;
        }
      }
      /* Hide print-only header on screen */
      .print-header, .print-date { display: none; }
    </style>
  <script>
    // Injected from backend context for JS interactivity
    const bookings = {{ bookings|tojson|safe }};
    const recipes = {{ recipes|tojson|safe }};
    const dates = {{ dates|tojson|safe }};
    let selection = new Set();
    if (Array.isArray(bookings)) {
      bookings.forEach(b => { b.id = Number(b.id); });
    }
    // --- BEGIN ALL JS FUNCTIONS ---
    // ...existing code from the main <script> block at the bottom of the file goes here...
    // (Copy all function definitions, helpers, and window assignments here)
    // --- END ALL JS FUNCTIONS ---
  </script>
  <h1 class="no-print">Weekly Booking Grid</h1>
          });
          
          const categoryOrder = ['Produce', 'Meat & Seafood', 'Dairy', 'Frozen', 'Pantry', 'Beverages', 'Other'];
          categoryOrder.filter(cat => categorized[cat]).forEach(category => {
            const categoryDiv = document.createElement('div');
            categoryDiv.style.cssText = 'margin-bottom: 20px; border-left: 4px solid #0066cc; padding-left: 12px;';
            
            const categoryTitle = document.createElement('h4');
            categoryTitle.textContent = category;
            categoryTitle.style.cssText = 'margin: 8px 0; color: #0066cc;';
            categoryDiv.appendChild(categoryTitle);
            
            const list = document.createElement('ul');
            list.className = 'shopping-items';
            
            categorized[category].forEach(item => {
              const li = document.createElement('li');
              li.textContent = `${formatQtyUnit(item.quantity, item.unit)} ${item.name}`.trim();
              list.appendChild(li);
            });
            
            categoryDiv.appendChild(list);
            wrapper.appendChild(categoryDiv);
          });
          
          target.appendChild(wrapper);
          document.querySelector('[style*="rgba(0,0,0,0.5)"]')?.remove();
        }
      } catch (error) {
        console.error('Error loading list:', error);
        alert('Failed to load shopping list');
      }
    }


    // (window assignments now done immediately after each function definition at the top)
  </script>
</body>
</html>

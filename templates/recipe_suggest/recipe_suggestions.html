<!-- Recipe Book Setup Admin Page -->
{% extends "base.html" %}
{% block content %}
<div class="container" style="max-width: 900px; margin: 0 auto; margin-top: 2em;">
    <h1 class="mb-4" style="font-size:2em; font-weight:bold;">Suggestions List</h1>
    <div class="card">
        <div class="card-header bg-primary text-white" style="font-weight:bold;">Suggestions List</div>
        <div class="card-body p-0">
            <table class="table table-striped mb-0">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Recipe Name</th>
                        <th>Suggested By</th>
                        <th>URL</th>
                        <th>Reason</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in suggestions %}
                    <tr>
                        <td>{{ s.created_at.strftime('%Y-%m-%d') if s.created_at else '' }}</td>
                        <td>{{ s.recipe_name }}</td>
                        <td>{{ s.suggested_by_name }}<br><span class="text-muted small">{{ s.suggested_by_email }}</span></td>
                        <td>{% if s.recipe_url %}<a href="{{ s.recipe_url }}" target="_blank">View</a>{% endif %}</td>
                        <td>{{ s.reason }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if suggestions|length == 0 %}
                <div class="p-3 text-muted">No suggestions found.</div>
            {% endif %}
        </div>
    </div>
</div>
        <div class="card mb-4">
            <div class="card-header bg-dark text-white">
                Parser Debug Index
            </div>
            <div class="card-body">
                {% for debug in parser_debugs %}
                <div class="mb-3">
                    <a href="{{ debug.url }}" target="_blank">{{ debug.url }}</a>
                        <a href="{{ url_for('debug_parser.debug_title_route', test_recipe_id=debug.id) }}" class="btn btn-info btn-sm">Debug</a>
                        <a href="{{ url_for('debug_parser.delete_debug', debug_id=debug.id) }}" class="btn btn-danger btn-sm">Delete</a>
                    <div class="text-muted small">Flagged by: {{ debug.flagged_by }} | {{ debug.flagged_at }}</div>
                </div>
                {% endfor %}
                {% if parser_test_list is defined and parser_test_list|length > 0 %}
                    <ul class="list-group">
                        {% for test in parser_test_list %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="fw-bold">{{ test.upload_source_detail or 'No Title' }}</span><br>
                                    <span class="text-muted">Flagged by: {{ test.uploaded_by or 'Unknown' }} | {{ test.upload_date.strftime('%Y-%m-%d %H:%M') if test.upload_date else '' }}</span>
                                </div>
                                <div class="d-flex align-items-center">
                                        <a href="{{ url_for('debug_parser.debug_title_route', test_recipe_id=test.id) }}" class="btn btn-outline-primary btn-sm">Debug</a>
                                        <form method="post" action="{{ url_for('delete_parser_test_recipe', test_recipe_id=test.id) }}" style="display:inline;">
                                            <button type="submit" class="btn btn-danger btn-sm ms-2" onclick="return confirm('Are you sure you want to delete this flagged/test recipe?');">Delete</button>
                                        </form>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-muted">No flagged/test recipes yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<!-- ...existing code... -->
<style>
.dropzone {
    border: 2px dashed #337ab7;
    border-radius: 8px;
    background: #f4f8fc;
    padding: 18px 12px;
    text-align: center;
    color: #337ab7;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.15s, border-color 0.15s;
}
.dropzone.dragover {
    background: #eaf4ff;
    border-color: #286090;
}
</style>
<script>
// Drag-and-drop support for file uploads
['pdfDropzone'].forEach(function(id) {
    var dz = document.getElementById(id);
    if (!dz) return;
    dz.addEventListener('dragover', function(e) {
        e.preventDefault();
        dz.classList.add('dragover');
    });
    dz.addEventListener('dragleave', function(e) {
        dz.classList.remove('dragover');
    });
    dz.addEventListener('drop', function(e) {
        e.preventDefault();
        dz.classList.remove('dragover');
        var input = dz.querySelector('input[type="file"]');
        if (e.dataTransfer.files.length) {
            input.files = e.dataTransfer.files;
            updateDropzoneLabel(input, id);
        }
    });
});
function updateDropzoneLabel(input, id) {
    var dz = document.getElementById(id);
    if (input.files.length) {
        dz.querySelector('span').textContent = input.files[0].name;
    } else {
        dz.querySelector('span').textContent = 'Drag & drop or click to select file';
    }
}

// Custom upload handler to include titlesOnly option
function uploadPdfWithTitlesOption() {
    var pdfInput = document.getElementById('pdfFile');
    var titlesOnlyInput = document.getElementById('titlesOnly');
    if (!pdfInput.files || pdfInput.files.length === 0) {
        alert('Please select a PDF file first.');
        return;
    }
}
    // PDF upload should use standard form POST, not AJAX. No JS needed here.
</script>
{% endblock %}

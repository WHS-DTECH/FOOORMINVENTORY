<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Confirm Recipe Upload</title>
	<style>
		body { font-family: Arial, sans-serif; margin: 2em; }
		.recipe-list { margin-bottom: 1.5em; }
		.recipe-block { border: 1px solid #ccc; padding: 1em; margin-bottom: 1em; border-radius: 6px; background: #fafafa; }
		.confirm-btn { padding: 0.5em 1.5em; font-size: 1.1em; }
		.status { margin-top: 1em; color: green; }
		.error { color: red; }
		.section-title { font-weight: bold; margin-top: 0.5em; }
		ul, ol { margin: 0.2em 0 0.5em 1.5em; }
	</style>
</head>
<body>
	<h2>Recipe Upload Confirmation</h2>
	{% if error %}
		<div class="error">{{ error }}</div>
	{% endif %}
	{% if step == 'titles' %}
		<form method="POST">
			<input type="hidden" name="step" value="titles_confirmed">
			<div class="recipe-list">
				<p>Select the recipe titles you want to import:</p>
				{% for recipe in recipes %}
					<div class="recipe-block">
						<label>
							<input type="checkbox" name="selected_titles" value="{{ recipe.name }}" checked>
							{{ recipe.name }}
						</label>
					</div>
				{% endfor %}
			</div>
			<button class="confirm-btn" type="submit">Confirm Titles</button>
		</form>
	{% elif step == 'details' %}
		<form method="POST">
			<input type="hidden" name="step" value="details_confirmed">
			<div class="recipe-list">
				<p>Review the full details for each recipe. Click confirm to save to the database.</p>
				{% for recipe in recipes %}
					<div class="recipe-block">
						<div><b>Name:</b> {{ recipe.name }}</div>
						<div class="section-title">Ingredients:</div>
						<ul>
						{% for ing in recipe.ingredients %}
							<li>
								{% if ing.quantity %}{{ ing.quantity }} {% endif %}
								{% if ing.unit %}{{ ing.unit }} {% endif %}
								{{ ing.ingredient or ing }}
							</li>
						{% endfor %}
						</ul>
						<div class="section-title">Equipment:</div>
						<ul>
						{% for eq in recipe.equipment %}
							<li>{{ eq }}</li>
						{% endfor %}
						</ul>
						<div class="section-title">Method:</div>
						<ol>
						{% for step in recipe.method.split('\n') %}
							<li>{{ step }}</li>
						{% endfor %}
						</ol>
						<div><b>Serving Size:</b> {{ recipe.serving_size }}</div>
					</div>
				{% endfor %}
			</div>
			<button class="confirm-btn" type="submit">Confirm & Save to Database</button>
		</form>
	{% elif step == 'done' %}
		<div class="status">Recipes saved: {{ saved_count }} | Skipped: {{ skipped_count }}</div>
		{% if errors %}
			<div class="error">
				<ul>
				{% for err in errors %}
					<li>{{ err }}</li>
				{% endfor %}
				</ul>
			</div>
		{% endif %}
		<a href="/upload">Upload another PDF</a>
	{% else %}
		<div>No recipes found or invalid step.</div>
		<a href="/upload">Back to upload</a>
	{% endif %}
</body>
</html>
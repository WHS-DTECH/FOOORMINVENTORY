<!-- This file has been renamed to shoplist.html -->
<div style="display: flex; flex-direction: column; align-items: center; margin-top: 32px; margin-bottom: 24px;">
  <h1 style="font-size: 2.5em; font-weight: bold; text-align: center;">Book the Shopping</h1>
  <div style="font-size: 1.5em; font-weight: bold; margin-top: 8px; text-align: center;">{{ week_label }}</div>
  <div style="margin-top: 16px; display: flex; gap: 8px; justify-content: center;">
    <a href="?week={{ week_offset - 1 }}" style="text-decoration: none;"><button>&#8592; Previous</button></a>
    <a href="?week=0" style="text-decoration: none;"><button>Today</button></a>
    <a href="?week={{ week_offset + 1 }}" style="text-decoration: none;"><button>Next &#8594;</button></a>
  </div>
</div>
  <!-- Row: Selected Bookings block and Scheduled Bookings button beside each other -->
  <div style="display: flex; flex-direction: row; align-items: flex-start; justify-content: center; margin-top: 36px; margin-bottom: 24px; gap: 18px;">
    <!-- Selected Bookings Box -->
    <div style="max-width: 650px; min-width: 420px; width: 100%; background: #f8fafc; border-radius: 10px; box-shadow: 0 2px 8px #e0e4ea; padding: 14px 16px; text-align: left;">
      <div style="font-weight: bold; font-size: 1.2em; margin-bottom: 8px;">Scheduled Bookings (Sorted by Teacher)</div>
      {% set teacher_map = {} %}
      {% for b in selected_bookings %}
        {% set teacher_key = b.teacher|trim|lower %}
        {% if teacher_key not in teacher_map %}
          {% set _ = teacher_map.update({teacher_key: {'teacher': b.teacher, 'staff_code': b.staff_code, 'bookings': []}}) %}
        {% endif %}
        {% set _ = teacher_map[teacher_key]['bookings'].append({'date': b.date, 'class': b.class, 'recipe': b.recipe}) %}
      {% endfor %}
      {% for teacher_key, tinfo in teacher_map.items() %}
        <div style="font-weight: bold; margin-top: 8px; display: flex; align-items: center;">
          <span style="display:inline-block; width:16px; height:16px; border-radius:4px; margin-right:8px; background: {{ teacher_color_map[teacher_key]|e }};"></span>
          {{ tinfo.teacher }} ({{ tinfo.staff_code }})
        </div>
        <ul style="margin: 0 0 8px 18px; padding: 0;">
          {% for booking in tinfo.bookings %}
            <li>{{ booking.date }} | {{ booking.class }} | {{ booking.recipe }}</li>
          {% endfor %}
        </ul>
      {% endfor %}
      <div style="margin-bottom: 0;">
        <button style="margin-right: 4px;">Select All</button>
        <button style="margin-right: 4px;">Clear</button>
        <button>Week (All) Shopping List</button>
      </div>
    </div>
    <!-- Scheduled Bookings Button -->
    <button id="showScheduledBtn" style="background: #2196f3; color: #fff; font-weight: bold; font-size: 1.1em; border: none; border-radius: 4px; padding: 10px 18px; box-shadow: 0 2px 8px #e0e4ea; cursor: pointer; min-width: 180px;">Scheduled Bookings</button>
  </div>

  <!-- Scheduled Bookings Popup Modal (Image 4 style) -->
  <div id="scheduledModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.18); z-index:1000; align-items:center; justify-content:center;">
    <div style="background:#f6fafd; border-radius:8px; box-shadow:0 2px 16px #b0b8c9; padding:24px 18px 18px 18px; min-width:650px; max-width:98vw; margin:40px auto; position:relative;">
      <div style="font-weight:600; color:#1976d2; font-size:1.15em; margin-bottom:8px;">Scheduled Bookings
        <span onclick="document.getElementById('scheduledModal').style.display='none'" style="float:right; font-size:1.3em; color:#888; cursor:pointer;">&times;</span>
      </div>
      <div class="text-muted" style="font-size:0.97em; margin-bottom:8px;">Click any booking to edit its details</div>
      <div style="overflow-x:auto;">
        <table id="scheduledTable" style="width:100%; border-collapse:collapse; background:#fff; border-radius:6px;">
          <thead>
            <tr style="background:#f2f4f8; color:#222;">
              <th style="padding:6px 10px; text-align:left;">Date</th>
              <th style="padding:6px 10px; text-align:left;">Period</th>
              <th style="padding:6px 10px; text-align:left;">Staff</th>
              <th style="padding:6px 10px; text-align:left;">Class</th>
              <th style="padding:6px 10px; text-align:left;">Recipe</th>
              <th style="padding:6px 10px; text-align:left;">Servings</th>
            </tr>
          </thead>
          <tbody id="scheduledTableBody">
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <script>
    document.getElementById('showScheduledBtn').onclick = function() {
      document.getElementById('scheduledModal').style.display = 'flex';
      // Fetch and render scheduled bookings
      fetch('/api/scheduled_bookings').then(r => r.json()).then(data => {
        const tbody = document.getElementById('scheduledTableBody');
        tbody.innerHTML = '';
        if (data.success && data.bookings.length > 0) {
          data.bookings.forEach(b => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td style="padding:6px 10px;">${b.date_required}</td>
              <td style="padding:6px 10px;">${b.period}</td>
              <td style="padding:6px 10px;">${b.staff_display}</td>
              <td style="padding:6px 10px;">${b.class_code}</td>
              <td style="padding:6px 10px;">${b.recipe_name || ''}</td>
              <td style="padding:6px 10px;">${b.servings}</td>
            `;
            tbody.appendChild(tr);
          });
        } else {
          const tr = document.createElement('tr');
          tr.innerHTML = '<td colspan="6" style="padding:8px; text-align:center; color:#888;">No bookings found.</td>';
          tbody.appendChild(tr);
        }
      });
    };
  </script>

  <div style="display: flex; flex-direction: column; align-items: center; margin-top: 40px;">
    <table style="border-collapse: collapse; background: #f8fafc; box-shadow: 0 2px 8px #e0e4ea; min-width: 700px;">
      <thead>
        <tr>
          <th style="border: 1px solid #cfd8dc; background: #f3f6fa; padding: 8px 12px; font-weight: bold;">Period</th>
          {% for date in week_dates %}
            <th style="border: 1px solid #cfd8dc; background: #e3ecf7; padding: 8px 12px; font-weight: bold;">
              {{ date.strftime('%A') }}<br>{{ date.strftime('%d/%m/%y') }}
            </th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% set teacher_colors = ['#1976d2', '#43a047', '#e53935', '#fbc02d', '#8e24aa', '#00838f', '#6d4c41', '#c62828', '#3949ab', '#f57c00'] %}
        {% set teacher_color_map = {} %}
        {% set teacher_idx = 0 %}
        {# Build teacher_color_map from scheduled_bookings #}
        {% for b in scheduled_bookings %}
          {% set teacher_key = b.staff|default('')|trim|lower %}
          {% if teacher_key and teacher_key not in teacher_color_map %}
            {% set _ = teacher_color_map.update({teacher_key: teacher_colors[teacher_idx % teacher_colors|length]}) %}
            {% set teacher_idx = teacher_idx + 1 %}
          {% endif %}
        {% endfor %}
        {# Build week_dates_str as a list of date strings #}
        {% set week_dates_str = [] %}
        {% for d in week_dates %}
          {% set _ = week_dates_str.append(d.strftime('%Y-%m-%d')) %}
        {% endfor %}
        {% for period in range(1,6) %}
        <tr>
          <td style="border: 1px solid #cfd8dc; background: #f3f6fa; text-align: center; font-weight: bold;">P{{ period }}</td>
          {% for date in week_dates %}
          <td style="border: 1px solid #cfd8dc; background: #fff; min-width: 120px; height: 70px; text-align: left; vertical-align: top; color: #222;">
            {% set booking = grid[(period, date)] %}
            {% if booking %}
              <div style="background: #d6f5d6; color: #222; border: 1px solid #b2e6b2; border-radius: 7px; padding: 7px 10px 7px 10px; margin-bottom: 5px; font-size: 1em; font-family: inherit; min-width: 160px; box-shadow: 0 1px 2px #e0e4ea;">
                <div style="font-weight: bold; font-size: 1.08em; margin-bottom: 2px;">{{ booking.recipe }}</div>
                <div style="font-size: 0.98em;">Class: {{ booking.class }}</div>
                <div style="font-size: 0.98em;">Teacher: {{ booking.staff.split(' - ')[1] if ' - ' in booking.staff else booking.staff }}</div>
                <div style="font-size: 0.98em;">Servings: {{ booking.servings }}</div>
                <div style="font-size: 0.98em;">{{ booking.date_display }}</div>
                <div style="font-size: 0.95em; color: #444; margin-top: 2px;">Tap to select</div>
              </div>
            {% else %}
              &mdash;
            {% endif %}
          </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <!-- Centered Generate Shopping List Button below the grid -->
    <div style="display: flex; justify-content: center; margin: 24px 0 0 0; width: 100%;">
      <button style="min-width: 180px; padding: 6px 18px; font-size: 1em; font-weight: bold; background: linear-gradient(90deg, #0074d9 0%, #00c3e3 100%); color: #fff; border: none; border-radius: 6px; box-shadow: 0 2px 8px #e0e4ea; cursor: pointer; transition: background 0.2s;">Generate Shopping List</button>
    </div>
  </div>
  </div

  <!-- Removed duplicate Selected Bookings block below the grid -->

  <!-- Two-column Shopping List Section -->
  <div style="display: flex; justify-content: center; gap: 32px; align-items: flex-start; margin-bottom: 40px;">
    <!-- Master Shopping List (Left) -->
    <div style="flex: 1 1 340px; min-width: 280px; max-width: 420px; background: #f8fafc; border-radius: 10px; box-shadow: 0 2px 8px #e0e4ea; padding: 18px 20px;">
      <div style="font-weight: bold; font-size: 1.2em; margin-bottom: 8px;">Master Shopping List</div>
      <div style="font-weight: bold; margin-bottom: 4px;">Other</div>
      <ul style="margin: 0 0 0 18px; padding: 0;">
        <li>1-2 tblsp fresh breadcrumbs — 0</li>
        <li>apples — 2 no.</li>
        <li>Baking soda — 1 tsp</li>
        <li>Black pepper — 0</li>
        <li>brown or white sugar — 30 g</li>
        <li>Brown sugar — 0.75 cup</li>
        <li>butter — 50 butter</li>
        <li>Butter (softened) — 1 cup</li>
        <li>butter or margarine — 60 g</li>
        <li>cheese — 100 grated</li>
        <li>Chocolate chips — 2 cups</li>
        <li>Don’t forget a container to take your cauliflower cheese home in — 0</li>
        <li>Eggs — 2 whole</li>
        <li>flour — 80 g</li>
        <li>flour — 50 plain</li>
        <li>Flour — 2 cups</li>
        <li>Granulated sugar — 0.5 cup</li>
        <li>milk — 500 milk</li>
        <li>oats — 40 g</li>
        <li>of cauliflower OR 1 head of broccoli OR a mix of both — 1 head</li>
        <li>Salt — 0.5 tsp</li>
        <li>sultanas — 50 g</li>
        <li>Vanilla extract — 1 tsp</li>
      </ul>
    </div>
    <!-- Shopping List by Teacher (Right) -->
    <div style="flex: 1 1 340px; min-width: 280px; max-width: 420px; background: #f8fafc; border-radius: 10px; box-shadow: 0 2px 8px #e0e4ea; padding: 18px 20px;">
      <div style="font-weight: bold; font-size: 1.2em; margin-bottom: 8px;">Shopping List</div>
      <!-- Teacher: Pringle -->
      <div style="font-weight: bold; color: #1976d2; background: #e3ecf7; border-radius: 6px; padding: 8px 12px; margin-bottom: 6px;">Teacher: Pringle</div>
      <ul style="margin: 0 0 8px 18px; padding: 0;">
        <li>300HOSP | Chocolate Chip Cookies | P3 | 2025-12-16</li>
        <li>SDFOOD | Apple and Sultana Crumble | P4 | 2025-12-18</li>
      </ul>
      <div style="font-weight: bold; margin-bottom: 4px;">Other</div>
      <ul style="margin: 0 0 12px 18px; padding: 0;">
        <li>apples — 2 no.</li>
        <li>Baking soda — 1 tsp</li>
        <li>brown or white sugar — 30 g</li>
        <li>Brown sugar — 0.75 cup</li>
        <li>Butter (softened) — 1 cup</li>
        <li>butter or margarine — 60 g</li>
        <li>Chocolate chips — 2 cups</li>
        <li>Eggs — 2 whole</li>
        <li>flour — 80 g</li>
        <li>Flour — 2 cups</li>
        <li>Granulated sugar — 0.5 cup</li>
        <li>oats — 40 g</li>
        <li>Salt — 0.5 tsp</li>
        <li>sultanas — 50 g</li>
        <li>Vanilla extract — 1 tsp</li>
      </ul>
      <!-- Teacher: Diplock -->
      <div style="font-weight: bold; color: #1976d2; background: #e3ecf7; border-radius: 6px; padding: 8px 12px; margin-bottom: 6px;">Teacher: Diplock</div>
      <ul style="margin: 0 0 8px 18px; padding: 0;">
        <li>300HOSP | Cauliflower Cheese | P4 | 2025-12-19</li>
      </ul>
      <div style="font-weight: bold; margin-bottom: 4px;">Other</div>
      <ul style="margin: 0 0 0 18px; padding: 0;">
        <li>1-2 tblsp fresh breadcrumbs — 0</li>
        <li>Black pepper — 0</li>
        <li>butter — 50 butter</li>
        <li>Don’t forget a container to take your cauliflower cheese home in — 0</li>
        <li>milk — 500 milk</li>
        <li>of cauliflower OR 1 head of broccoli OR a mix of both — 1 head</li>
      </ul>
    </div>
  </div>
</body>
</html>
  </nav>
